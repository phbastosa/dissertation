%========================================================================
% Modelo para elaboracao de textos academicos: TCC, dissertacoes e teses
% Elaborado pelo GISIS - Grupo de Imageamento Sismico e Inversão Sismica.
%========================================================================
\chapter{Revisão Bibliográfica}
\label{ch:revisaobibliografica}

A crescente demanda por simulações precisas e eficientes em geofísica, especialmente na modelagem sísmica, tem impulsionado o desenvolvimento de técnicas avançadas de computação paralela e soluções numéricas especializadas. A modelagem sísmica desempenha um papel vital na análise e interpretação de dados sísmicos, permitindo a visualização e caracterização de estruturas geológicas complexas. Neste capítulo, será realizada uma revisão dos principais conceitos sobre computação paralela, sobre a equação da onda acústica de densidade constante e sobre três soluções numéricas para a equação eikonal. 

\section{Computação de alto desempenho}

A programação de alta performance com placas gráficas, conhecida como GPGPU (\textit{General-Purpose computing on Graphics Processing Units}), tem se destacado devido à sua capacidade de acelerar o processamento de tarefas intensivas computacionalmente. A utilização eficiente da arquitetura paralela das GPUs possibilita a execução simultânea de um grande número de pequenos processos, resultando em desempenho significativamente superior em comparação com abordagens convencionais baseadas em CPU \cite{luebke2008cuda}. A implementação eficaz de modelos de programação paralela, como o paralelismo de dados e o paralelismo de tarefas se torna eficaz para resolver grandes problemas em geociências. O paralelismo de dados envolve a divisão de grandes conjuntos de dados em blocos menores para processamento simultâneo, enquanto o paralelismo de tarefas permite a execução concorrente de diferentes operações independentes. A utilização adequada desses modelos de programação paralela é essencial para a exploração eficiente do potencial de processamento paralelo das GPUs e para a maximização do desempenho computacional  \cite{sterling2017high}.

A otimização e eficiência na programação em placas gráficas envolvem a aplicação de técnicas especializadas, como o uso eficiente da memória compartilhada, a minimização da latência de acesso à memória global, a redução da sobrecarga de comunicação entre a CPU e a GPU, e a minimização do tráfego de dados entre essas unidades. Além disso, a utilização de algoritmos otimizados e a redução da fragmentação de dados são cruciais para garantir o máximo aproveitamento dos recursos de processamento disponíveis \cite{luebke2008cuda}. Diversas linguagens de programação e bibliotecas foram desenvolvidas para facilitar a programação de alta performance em GPUs, incluindo CUDA, OpenCL e Vulkan. Essas linguagens oferecem abstrações de nível mais alto e permitem a implementação eficiente de algoritmos complexos, explorando todo o potencial de processamento paralelo das placas gráficas. As tendências futuras nesse campo incluem o desenvolvimento de arquiteturas de GPU mais especializadas e adaptadas a tarefas específicas, bem como o avanço contínuo de técnicas de programação paralela para atender às demandas cada vez maiores de processamento de dados e cálculos intensivos \cite{sterling2017high}. Neste trabalho a implementação dos algoritmos de modelagem foi implementada em CUDA C++ para minimizar o tempo de execução no cálculo das ondas de primeira chegada em três dimensões.

\section{Modelagem sísmica}

Muitos fenômenos físicos tem suas simplificações e condições para serem simulados computacionalmente. O método sísmico parte do princípio da propagação de ondas mecânicas geradas a partir de uma fonte explosiva, sendo registradas em receptores posicionados na superfície da terra ou no fundo marinho \cite{sheriff1995exploration, rosa2010analise}. Um modelo de propriedades físicas de subsuperfície é necessário para a simulação computacional. Considerando a simplificação da equação da onda para meios acústicos e isotrópicos, onde as propriedades do meio são as velocidades da onda P, as frentes de onda podem ser geradas para realizar estudos sintéticos experimentais. Duas das soluções de equações que regem fenômenos físicos são a analítica e numérica. A solução analítica de um problema mostra a resposta exata do fenômeno em condições específicas previamente estabelecidas e a solução numérica resolve o problema de forma geral para diversos cenários \cite{igel2017computational}. No caso da modelagem sísmica com solução analítica, as condições estabelecidas se aplicam ao modelo de velocidade, resolvendo a equação em um modelo homogêneo ou com camadas plano paralelas sem variação lateral de velocidade.  

\subsection{Equação da onda para meios acústicos}

A equação base para a simulação sísmica utilizando a simplificação para meios acústicos pode ser formulada da seguinte maneira
\begin{equation}
	\nabla^2u - \dfrac{1}{v^2}\dfrac{\partial^2u}{\partial t^2} = f,	
	\label{wave_equation}
\end{equation}
\noindent onde $u = u(\mathbf{x},t)$ é o campo de pressão hidrostática, $t$ é o tempo de propagação e $\mathbf{x} = (x,y,z)$ são as variáveis do sistema de coordenadas para o caso 3D. $v = v(\mathbf{x})$ é o modelo de velocidade, $f(t)$ é uma função que determina o formato do pulso propagado e $\nabla^2 = \partial^2_x + \partial^2_y + \partial^2_z$ é o operador laplaciano. \citeonline{igel2017computational} mostra algumas formas de resolver a equação da onda numericamente de forma prática e aplicada. O método das diferenças finitas é um dos métodos mais utilizados em simulações sísmicas. O princípio do método é estimar o valor da derivada numericamente utilizando a série de Taylor, definida detalhadamente no trabalho de \citeonline{de2005funccoes}. Somente derivadas de segunda ordem são necessárias para resolver a equação \ref{wave_equation} e a aproximação da derivada pode ser definida a partir da seguinte expressão
\begin{equation}
	\dfrac{\partial^2 f(x)}{\partial x^2} \approx \dfrac{f[i - dh] - 2f[i] + f[i + dh]}{dh^2},
	\label{derivada_2}
\end{equation}    
\noindent onde $f(x)$ é uma função contínua arbitrária definida no eixo $x \in \mathbb{R}$ e $f[i]$ é uma função discreta definida na mesma reta com intervalos regulares $dh$. A equação da onda para meios acústicos pode ser escrita em seu formato discreto  substituindo a equação \ref{derivada_2} na equação \ref{wave_equation}, para cada eixo $x,y,z,t$, respectivamente. O método das diferenças finitas possui certas limitações como, por exemplo, a dispersão e instabilidade numérica \cite{aki1980quantitative}. Seguindo os trabalhos de \citeonline{mufti1990large, bulcao2004modelagem} e \citeonline{robertsson2012numerical}, as condições para contornar problemas numéricos na modelagem sísmica para meios acústicos seguem na forma a seguir
\begin{equation}
	\begin{cases}
		dh \le v_{\text{min}} \,/\, (\alpha \cdot f_{\text{max}}) \\
		dt \le dh \,/\, (\beta \cdot v_{\text{max}}),
	\end{cases}
\end{equation}   
\noindent onde $dh$ e $dt$ são os parâmetros de discretização espacial e temporal, respectivamente, $v_{\text{min}}$ e $v_{\text{max}}$ são as velocidades da onda P mínima e máxima no modelo, $f_{\text{max}}$ é a frequência máxima da fonte sísmica aplicada, e $\alpha$ e $\beta$ são as quantidades de amostras para representar um comprimento de onda no espaço e no tempo, respectivamente. Os valores de $\alpha$ e $\beta$ variam de acordo com a ordem do operador de diferenças finitas \cite{moczo2000stability, bulcao2004modelagem}.    

A fonte sísmica pode assumir diferentes formas dependendo de seu formato ou equacionamento. Na modelagem sísmica, a fonte é aplicada como um pulso definido no tempo discreto, onde a cada passo de tempo uma amostra do sinal é injetada, em uma posição no espaço, na resolução da equação da onda. A segunda derivada da equação gaussiana \cite{ricker1953form} pode ser usada para gerar o pulso sísmico, sendo definida da seguinte maneira
\begin{equation}
	\begin{cases}
		f_p = f_{\text{max}} / (3\sqrt{\pi}) \\
		g(t) = (1 - 2 \pi (\pi f_p t)^2) \exp(-\pi (\pi f_p t)^2),
		\label{ricker}
	\end{cases}
\end{equation}
\noindent sendo $f_p$ a frequência de pico, $g(t)$ a fonte sísmica e $t$ o eixo do tempo. 

Ao contrário de dados sísmicos reais, onde o meio geológico absorve a energia da onda mecânica, em simulação computacional, para os casos onde a equação da onda não contempla fenômenos dissipativos, existem técnicas para prevenir reflexões indesejadas causadas pelas bordas do modelo finito empregado. A condição de bordas absortivas de \citeonline{cerjan1985nonreflecting} é uma abordagem clássica para resolver o problema de bordas na modelagem sísmica, porém outras formulações mais elaboradas podem ser utilizadas. Uma possibilidade é aplicar a formulação descrita no trabalho de \citeonline{chern2019reflectionless}. A condição de borda utilizada neste trabalho é regida pela equação a seguir
\begin{equation}
	w(\mathbf{x}) = \exp(- p(n_b - \mathbf{x})^2),
	\label{cerjan}	
\end{equation}      
\noindent onde $w(\mathbf{x})$ é a função amortecimento definida somente nos pontos da borda $\mathbf{x}$, $p$ é um fator de atenuação e $n_b$ é a quantidade de amostras na borda. \citeonline{bording1921finite} compara experimentos para determinar valores otimizados para $n_b$ e $p$. Em contrapartida \citeonline{gao2017comparison} mostram que a técnica esponjosa absortiva foi superada pelas novas variantes utilizando modificações da equação da onda. 

Nas próximas seções, somente as frentes de onda transmitidas e refratadas são exploradas pois constituem o principal objeto de pesquisa deste trabalho. As ondas refratadas acontecem quando o afastamento entre a fonte e o receptor são suficientemente grandes, dependendo da configuração de camadas geológicas em subsuperfície. Essas ondas refratadas comumente são chamadas de primeiras chegadas, pois se propagam em camadas de maior velocidade e assim são registradas em um tempo menor que as demais frentes de onda.          

\subsection{Equação eikonal}

A equação eikonal pode ser definida como uma aproximação de altas frequências para a equação da onda em meios acústicos. Essa definição pode ser expandida para outras simplificações de meio, como, por exemplo, o meio elástico isotrópico \cite{cerveny2003seismic}. \citeonline{rawlinson2008seismic} mostram as etapas de simplificação partindo da equação \ref{wave_equation}, assumindo uma solução periódica envolvendo tempo e frequência angular, aplicando essa solução na equação da onda, simplificando os termos e aplicando o limite da frequência angular tendendo ao infinito. Assim, a equação eikonal em três dimensões segue no formato 
\begin{equation}
	\left[\dfrac{\partial T(\mathbf{x})}{\partial x}\right]^2 + \left[\dfrac{\partial T(\mathbf{x})}{\partial y}\right]^2 + \left[\dfrac{\partial T(\mathbf{x})}{\partial z}\right]^2 = \dfrac{1}{v^2(\mathbf{x})}, 	
	\label{eikonal_full}
\end{equation} 
\noindent sendo $T(\mathbf{x})$ a função tempo de trânsito avaliada na posição $\mathbf{x} = (x,y,z)$ e $s = 1/v$ pode ser chamado de vagarosidade, o inverso da velocidade. A principal aplicação da equação eikonal utilizando o método sísmico parte da modelagem sísmica, com o trabalho pioneiro de \citeonline{vidale1988finite} onde os tempo de trânsito das primeiras chegadas são calculados. Outras aplicações são os métodos de estimativa da velocidade, como a tomografia de primeira chegada \cite{zhang1998nonlinear, sei1994gradient, tromp2005seismic, taillandier2009first},  e as técnicas de imageamento sísmico, como a migração em profundidade   \cite{gray1994kirchhoff, zhang2006refraction}.  
 
\subsection{Equação analítica para ondas refratadas}

Apesar de existir em parametrizações variadas do modelo de velocidade, as formulações para o cálculo das primeiras chegadas possuem certas limitações \cite{kearey2002introduction}. Somente uma variação será explorada, onde o modelo de velocidades deve ser plano paralelo com camadas horizontais sem variação de velocidade lateral e a fonte e os receptores devem estar na mesma profundidade. A equação analítica para este caso pode ser escrita de forma generalizada no formato 
\begin{equation}
	\begin{cases}
		t_n = \dfrac{x}{v_n} + \displaystyle\sum_{i=1}^{n-1} \dfrac{2z_i \cos(\theta_{in})}{v_i}\\
		\theta_{in} = \arcsin(v_i / v_n),
	\end{cases}
	\label{analytic_refractions}
\end{equation}
\noindent onde $t_n$ e $v_n$ é o tempo e a velocidade da $n$-ésima camada, $x$ é a distância entre a fonte e o receptor, $z_i$ são a espessura da $i$-ésima camada e $\theta_{in}$ é o ângulo crítico da refração. 

As componentes da equação \ref{analytic_refractions}, ilustradas para uma trajetória entre fonte e receptor, são apresentadas na Figura \ref{fig:refracted_analytic}. Na prática, um arranjo de receptores para uma fonte, as velocidades e as espessuras das camadas são consideradas. Então, para cada interface refratora, as camadas anteriores são utilizadas. Para o caso de uma interface, a equação \ref{analytic_refractions} pode ser definida da seguinte forma 
\begin{equation}
	\begin{cases}
		t = \dfrac{x}{v_2} + \dfrac{2z_1cos(\theta_{12})}{v_1}\\
		\theta_{12} = \arcsin(v_1 / v_2),
	\end{cases}
	\label{analytic_one_layer_case}
\end{equation}    
\noindent enquanto a onda direta recebe o tempo da cinemática clássica $t = x / v_1$. Com as equações abordadas acima, é possível gerar um sismograma sintético somente com tempos analíticos da primeira chegada. Para isso, é necessário coletar os tempos mínimos gerados por cada interface refratora inclusive a onda direta. Essa abordagem analítica desenvolve o papel, neste trabalho, de mensurar os erros referentes aos métodos numéricos estudados.

\begin{figure}[H]
	\centering
	\includegraphics[width = 12cm, height = 7cm]{Imgs/RevisaoBibliografica/refracted_analytic.png}
	\caption{Esquema de modelagem analítica dos tempos da onda refratada. S e R são as posições da fonte e do receptor, respectivamente. V e Z são as velocidades e as espessuras das camadas. $\theta$ é o angulo crítico das refrações e $i$ e $n$ se relacionam com a equação \ref{analytic_refractions}. Esquema geral com limitações entre posição de fonte e receptor, onde precisam estar na mesma profundidade, e velocidades, onde devem ser constantes lateralmente contendo camadas planas e horizontais.}
	\label{fig:refracted_analytic}
\end{figure}

\subsection{Método clássico - Podvin e Lecomte (1991)}

O método base utilizado para mensurar os avanços tanto em precisão quanto em eficiência computacional dos métodos numéricos que resolvem a equação eikonal foi a formulação de \citeonline{podvin1991finite}. Grandes contribuições foram publicadas em relação a localização não linear de epicentro e hipocentro de terremotos utilizando a formulação clássica, originadas com o trabalho de  \citeonline{wittlinger1993earthquake}, além das contribuições em tomografia e migração já mencionadas. A formulação de \citeonline{podvin1991finite} apresenta algumas limitações como instabilidade em camadas com alto ângulo de mergulho \cite{afnimar2000finite} e discrepância no cálculo dos tempos de trânsito utilizando a técnica da reciprocidade, onde a fonte assume a posição dos receptores e vice-versa \cite{tryggvason2006travel}. \citeonline{lomax2009earthquake} hospedam um repositório no \textit{GitHub}, de livre acesso, contendo os códigos originais para o cálculo da primeira chegada.  

A resolução da equação eikonal parte do princípio de Huygens, onde cada ponto pertencente a uma frente de onda pode se comportar como uma fonte que expande outra frente de onda. Então, a solução de \citeonline{podvin1991finite} aplica sistematicamente o princípio de Huygens considerando algumas possibilidades de propagação. Cada frente de onda, como, por exemplo, difrações, refrações e onda direta, é calculada de forma independente sendo atualizada no volume de tempos como a opção de menor tempo entre as demais. Especificamente, operadores de diferenças finitas para casos 1D, 2D e 3D são aplicados, e considerando a indexação da Figura \ref{fig:voxel_full}, os principais operadores serão mostrados. 
\begin{figure}[H]
	\centering
	\includegraphics[width = 7cm, height = 6cm]{Imgs/RevisaoBibliografica/voxel_full.png}
	\caption{Esquema de indexação para o cálculo dos operadores de \citeonline{podvin1991finite}. O ponto vermelho é o alvo da propagação e os demais são seus vizinhos.}
	\label{fig:voxel_full}
\end{figure}
Os operadores 1D levam em consideração somente dois pontos, porém dependendo do ângulo de incidência as propriedades de vagarosidade devem ser escolhidas minuciosamente. O primeiro operador 1D se relaciona com a onda de corpo com propagação direta no sentido $(i,j-1,k) \to (i,j,k)$ e, seguindo os índices mostrados na Figura \ref{fig:voxel_full}, recebe a formulação
\begin{equation}
	T_{i,j,k} = T_{i,j-1,k} + dh\, \mathbf{min}(S_{i,j-1,k},\, S_{i,j-1,k-1},\, S_{i-1,j-1,k},\, S_{i-1,j-1,k-1}),
	\label{1d_head_wave}
\end{equation}   
\noindent onde $T$ e $S$ são os volumes de tempo e de vagarosidade, respectivamente, e $dh$ é o espaçamento espacial do modelo. Existem mais 5 direções para se aplicar o operador da equação \ref{1d_head_wave}, totalizando 6 operadores no total. Para o caso 1D em ondas difratadas, que ocorrem nas diagonais dos cubos, os operadores nos sentidos $(i-1,j-1,k-1) \to (i,j,k)$, $(i-1,j,k-1) \to (i,j,k)$ e $(i-1,j-1,k) \to (i,j,k)$, são, respectivamente, do seguinte formato
\begin{equation}
	\begin{cases}
		T_{i,j,k} = T_{i-1,j-1,k-1} + \sqrt{3}\,dh\,S_{i-1,j-1,k-1} \\
		T_{i,j,k} = T_{i-1,j,k-1} + \sqrt{2}\,dh\,\mathbf{min}(S_{i-1,j-1,k-1},\,S_{i-1,j,k-1}) \\
		T_{i,j,k} = T_{i-1,j-1,k} + \sqrt{2}\,dh\,\mathbf{min}(S_{i-1,j-1,k-1},\,S_{i-1,j-1,k}).
	\end{cases}
	\label{1D_diffractions}
\end{equation}
\noindent Como algumas frentes de onda se propagam entre dois cubos, a vagarosidade mínima é estrategicamente calculada para assegurar que a frente de onda se propagará pelo meio de maior velocidade, respeitando assim o princípio de Fermat. Operadores 1D de ondas difratadas são aplicados em 20 direções ao todo. 

Os operadores 2D seguem uma condição de iluminação sendo formulados, utilizando os pontos $(i-1,j,k-1)$ e $(i-1,j,k)$, a seguir
\begin{equation}
	\begin{cases}
		(1) \,\, S_{ref} = \mathbf{min}(S_{i-1,j-1,k-1},\, S_{i-1,j,k-1})  \\
		(2) \,\, 0 \le (T_{i-1,j,k} - T_{i-1,j,k-1}) \le \sqrt{2}\,dh\,S_{ref} \\
		(3) \,\, T_{i,j,k} = T_{i-1,j,k} + \sqrt{(dh\,S_{ref})^2 - (T_{i-1,j,k} - T_{i-1,j,k-1})^2},	
	\end{cases}
	\label{2D_operators}
\end{equation}
\noindent sendo $(1)$ a aplicação do princípio de Fermat, $(2)$ a condição de iluminação, $(3)$ o cálculo do tempo de trânsito e $S_{ref}$ é a vagarosidade de referência em cada operador. Para esse caso, vinte e quatro operadores são aplicados nas redondezas do ponto alvo $T_{i,j,k}$. 

Os operadores 3D são altamente condicionais, utilizam três pontos vizinhos e, para cada cubo do modelo, três operadores são aplicados. Para melhor entendimento, a Figura \ref{fig:voxel3d} mostra as direções para um cubo, dos pontos utilizados para o cálculo dos operadores 3D seguindo a simbologia do trabalho de \citeonline{podvin1991finite}. 
\begin{figure}[H]
	\centering
	
	\subfloat[]{\includegraphics[width=4.5cm,height=4cm]{Imgs/RevisaoBibliografica/3D_xz.png}}
	\subfloat[]{\includegraphics[width=4.5cm,height=4cm]{Imgs/RevisaoBibliografica/3D_yz.png}}
	\subfloat[]{\includegraphics[width=4.5cm,height=4cm]{Imgs/RevisaoBibliografica/3D_xy.png}}
		
	\caption{Esquema de pontos utilizados na aplicação dos operadores 3D de \citeonline{podvin1991finite}. (a) plano xz, (b) plano yz e (c) plano xy. Pontos em verde são a vizinhança selecionada, o ponto em contorno azul é a posição da vagarosidade de referência, e o ponto em vermelho é o alvo da propagação.}
	\label{fig:voxel3d}
\end{figure}
\noindent Então, os operadores 3D seguem o mesmo padrão para quaisquer pontos (P,Q,M,N) selecionados corretamente. As formulações completas para uma composição de pontos mostrados na Figura \ref{fig:voxel3d}, podem ser escritas da maneira a seguir
\begin{multline}
	MNP \to T_{i,j,k}: \\ 
	M \le N \,\cap\, M \le P \\
	2(P-M)^2 + (N-M)^2 \le (dh\,S_{ref})^2 \\
	2(N-M)^2 + (P-M)^2 \le (dh\,S_{ref})^2 \\
	(N-M)^2 + (P-M)^2 + (N-M)(P-M) \ge 0.5(dh\,S_{ref})^2 \\
	T_{i,j,k} = N + P - M \sqrt{(dh\,S_{ref})^2 - (N-M)^2 - (P-M)^2}, \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,
	\label{MNP-R}
\end{multline}
\begin{multline}
	QNP \to T_{i,j,k}: \\	
	N \le Q \,\cap\, P \le Q \\
	(Q-N)^2 + (Q-P)^2 + (Q-N)(Q-P) \le 0.5(dh\,S_{ref})^2 \\
	T_{i,j,k} = Q + \sqrt{(dh\,S_{ref})^2 - (Q-N)^2 - (Q-P)^2}, \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,   
	\label{QNP-R}
\end{multline}
\begin{multline}
	NMQ \to T_{i,j,k}: \\	
	N \ge M \,\cap\, N-M \le Q-N \\
	2(Q-N)^2 + (N-M)^2 \le (dh\,S_{ref})^2 \\
	T_{i,j,k} = Q + \sqrt{(dh\,S_{ref})^2 - (Q-N)^2 - (N-M)^2}, \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,
	\label{NMQ-R}
\end{multline}
\begin{multline}
	PMQ \to T_{i,j,k}: \\	
	P \ge M \,\cap\, P-M \le Q-P \\
	2(Q-P)^2 + (P-M)^2 \le (dh\,S_{ref})^2 \\
	T_{i,j,k} = Q + \sqrt{(dh\,S_{ref})^2 - (Q-P)^2 - (P-M)^2}. \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,
	\label{PMQ-R}
\end{multline}

A resolução da equação eikonal é iterativa e, a cada iteração, é necessário que uma frente de onda se expanda passando pelos pontos onde o tempo de trânsito é desconhecido. Inicialmente, o volume dos tempos de trânsito recebe o valor zero na fonte e um valor tendendo ao infinito nas demais posições. Os pontos vizinhos à posição da fonte são inicializados utilizando a equação da cinemática clássica $t = x / v$, considerando que cada bloco do modelo possui um valor de velocidade constante. Para posições de fonte irregulares, ou seja, posições que não pertencem a nenhum ponto da malha, o tempo da fonte é inicializado de acordo com a distância entre a fonte e o ponto da malha mais próximo. Assim, a solução iterativa de \citeonline{podvin1991finite} pode propagar o tempo inicial para as demais posições automaticamente. Após a inicialização, um volume lógico é inicializado com valores de verdadeiro e falso, sendo verdadeiro utilizando para as posições que convergiram para um tempo de trânsito aceitável e falso, para posições que ainda não convergiram. O número de iterações depende da distância, em pontos de malha, entre a posição da fonte e as extremidades do modelo de velocidade, sendo a maior distância em pontos de malha que houver. Durante as iterações, todos os pontos do modelo são acessados, porém as equações são calculadas somente onde o volume lógico indica necessidade de atualização. A partir do momento que o tempo de trânsito de um certo ponto atinge a confiabilidade dada por uma tolerância, novos pontos são acionados como verdadeiros e assim, os operadores computam novos tempos em regiões ainda não exploradas até completar toda a extensão do modelo de velocidades. O algoritmo desenvolvido pelo autor deste trabalho, para resolver a equação eikonal utilizando os operadores de \citeonline{podvin1991finite}, pode ser encontrado na plataforma de compartilhamento de código aberto GitHub. 

\subsection{\textit{Fast Iterative Method}}

Originalmente publicado em \citeonline{jeong2008fast}, o \textit{Fast Iterative Method} (FIM) é uma metodologia que utiliza uma frente de onda variável que se adapta ao modelo de velocidades, tornando assim uma frente de onda mais realística. FIM é uma técnica de resolução baseada nas formulações de frente de onda expansivas como o \textit{Fast Marching Method} (FMM). O FMM, formulado por \citeonline{sethian1999fast}, possui grandes aplicabilidades em geociências como os trabalhos de \citeonline{sethian19993, rawlinson2004multiple, lelievre2011computing, jiang2021fast} e até a presente data deste trabalho ainda é explorado com diferentes implementações \cite{white2020pykonal, chenpyekfmm2023}. Por outro lado o FIM, ainda pouco estudado na área de geociências, possui vantagens computacionais em relação ao FMM, onde em cada iteração se resolve uma ordenação com a estrutura de dados \textit{heap}, onde elementos são alocados em uma fila de prioridade, para atualizar a frente de onda irregular. O FIM não depende de estruturas de dados e cada ponto pertencente à frente de onda irregular é resolvido simultaneamente. A estratégia do FMM pode ser eficiente em computação sequencial, porém torna-se ineficiente utilizando paralelismo de larga escala até o momento da publicação de \citeonline{jeong2008fast}. Alguns anos depois, \citeonline{yang2017highly} resolvem a aplicabilidade do FMM, porém essa solução não foi considerada neste estudo. A ênfase neste trabalho foi a experimentação da formulação de \citeonline{jeong2008fast}, ainda pouco explorada. 

Outras contribuições como a implementação do FIM em diferentes discretizações do modelo com malhas triangulares e tetraédricas \cite{fu2011fast, fu2013fast} e melhoria da eficiência computacional \cite{dang2014fast, hong2016multi, hong2022mg} foram desenvolvidas. A discussão em relação à imprecisão dos tempos de trânsito utilizando a formulação de \citeonline{jeong2008fast} foi destacada por \citeonline{cai2023improved}. A modificação considerada foi aumentar a quantidade de pontos vizinhos para o cálculo dos tempos de trânsito sem diminuição significativa da eficiência computacional, porém a melhoria proposta não foi acoplada a este trabalho. 

A ideia principal do FIM é resolver a equação eikonal utilizando uma lista de ativos que contempla os pontos da frente de onda, sem manter estruturas de dados caras, como um \textit{heap} por exemplo. O método de \citeonline{jeong2008fast} mantém um relacionamento mais flexível e atualiza todos os pontos da malha contidos na lista ativa simultaneamente usando computação paralela. Durante cada iteração, expandimos a lista de pontos ativos e a frente de onda expande para incluir todos os pontos que podem ser afetados pelas atualizações atuais.  Um ponto contido na frente de onda pode ser removido da lista ativa quando sua solução estiver atualizada em relação para seus vizinhos (ou seja, convergiu). Somente os pontos contidos na lista de ativos são acessados em cada iteração e esses pontos podem ser atualizados simultaneamente. A inicialização se assemelha com o método de resolução da equação eikonal apresentado na seção anterior, onde a posição da fonte recebe o valor zero e os demais pontos no volume de tempo de trânsito recebe um valor alto.

A versão utilizada neste trabalho decompõe o modelo em pequenos blocos contendo 4x4x4 amostras de malha, versão esta chamada de \textit{block}-FIM. Cada bloco se comporta como um ponto de malha na frente de onda expansiva, e assim a lista se preenche com blocos ativos ao invés de pontos. Nessa estratégia, se utiliza otimizações específicas de computação paralela comentadas no trabalho de \citeonline{jeong2008fast}, onde o algoritmo original \textit{block}-FIM pode ser encontrado no Github, num repositório hospedado pelos próprios autores.

\begin{algorithm}[H]
	\caption{Equação principal do \textit{Fast Iterative Method}}
	\footnotesize
	\SetAlgoLined
	\Entrada{$T$, $\,S_{i,j,k}$, $\,dh$} 
	\Saida{$T_{i,j,k}$}
	\Inicio
	{	
		$a = \mathbf{min}(T_{i-1,j,k}, T_{i+1,j,k})$ \\
		$b = \mathbf{min}(T_{i,j-1,k}, T_{i,j+1,k})$ \\
		$c = \mathbf{min}(T_{i,j,k-1}, T_{i,j,k+1})$ \\
		
		$a,b,c \leftarrow \mathbf{ordene}(a,b,c)\,\, \text{tal que}\,\, a > b > c$ \\
		\Se{$c < \infty$}
		{
			$T_{i,j,k} \leftarrow c + dh\,S_{i,j,k} \\
			
			\Se{$T_{i,j,k} > b$}
			{
				$T_{aux} = 0.5(b + c + \sqrt{2(dh\,S_{i,j,k})^2 - (b - c)^2})$ \\
				
				\Se{$T_{aux} > b$}
				{
					$T_{i,j,k} = T_{aux}$ \\	
				}
				 
				\Se{$T_{i,j,k} > a$}
				{
					$T_{aux} = \left((a + b + c) + \sqrt{2(a(b-a) + b(c-b) + c(a-c))}\right) / 3$ \\	
					
					\Se{$T_{aux} > a$}
					{
						$T_{i,j,k} = T_{aux}$ \\ 
					}
				}	
			}
		}
	}
\end{algorithm}

O algoritmo 1 mostra o núcleo de resolução do FIM, onde o primeiro passo é ordenar as diferenças dos tempos de trânsito dos vizinhos diretos do ponto alvo $T_{ijk}$ e aplicar condições de iluminação desenvolvidas empiricamente por \citeonline{jeong2008fast}. 

\subsection{\textit{Fast Sweeping Method}}

O \textit{Fast Sweeping Method} (FSM) \cite{zhao2005fast} é uma formulação que utiliza os operadores clássicos aplicados desde o trabalho de \citeonline{vidale1988finite}, porém aplica uma ordem específica de atualização. Essa forma pode ser chamada de iterações de Gauss-Seidel, onde o domínio computacional é acessado utilizando diferentes direções. Para o caso 3D, oito direcionamentos são aplicados resolvendo as equações conhecidas e desenvolvidas por \citeonline{vidale1988finite, afnimar2000finite}. As direções específicas a serem percorridas são descritas a seguir
\begin{center}
\noindent (1) i = 1:Nx;$\,\,\,\,$ j = 1:Ny;$\,\,\,\,$ k = 1:Nz,$\,\,\,\,\,\,\,\,$ (2) i = Nx:1;$\,\,\,\,$ j = 1:Ny;$\,\,\,\,$ k = 1:Nz, \newline 
\noindent (3) i = 1 Nx;$\,\,\,\,$ j = Ny:1;$\,\,\,\,$ k = 1:Nz,$\,\,\,\,\,\,\,\,$ (4) i = 1:Nx;$\,\,\,\,$ j = 1:Ny;$\,\,\,\,$ k = Nz:1, \newline
\noindent (5) i = 1:Nx;$\,\,\,\,$ j = Ny:1;$\,\,\,\,$ k = Nz:1,$\,\,\,\,\,\,\,\,$ (6) i = Nx:1;$\,\,\,\,$ j = 1:Ny;$\,\,\,\,$ k = Nz:1, \newline 
\noindent (7) i = Nx:1;$\,\,\,\,$ j = Ny:1;$\,\,\,\,$ k = 1:Nz,$\,\,\,\,\,\,\,\,$ (8) i = Nx:1;$\,\,\,\,$ j = Ny:1;$\,\,\,\,$ k = Nz:1. $\,\,\,\,\,\,\,\,\,\,\,\,\,$
\end{center}
\noindent onde a numeração é a ordem de aplicação para um modelo limitado por (Nx, Ny, Nz) amostras. Com essa ordenação, os operadores de diferenças finitas podem ser derivados somente para uma única direção, variando com indicadores direcionais para a vagarosidade e para os tempos de trânsito vizinhos. A contribuição utilizada neste trabalho se origina de \citeonline{noble2014accurate}, onde novos operadores são aplicados para aprimorar a precisão dos tempos de trânsito. A inovação foi considerar a forma expandida dos operadores de oito pontos de \citeonline{vidale1988finite}, onde a seguinte derivada do tempo $T$ em relação a direção $x$ é considerada    
\begin{equation}
	\dfrac{\partial T}{\partial x} \approx \left(\dfrac{T_{i,j,k} - T_i}{4\, dh_x}\right),
	\label{fsm_8p_derivative}
\end{equation}
\noindent onde $T_i$ são os sete pontos na redondeza de $T_{i,j,k}$ para o primeiro quadrante, ou seja,
\begin{equation}
	T_i = - T_{i-1,j,k} + T_{i,j-1,k} - T_{i-1,j-1,k} + T_{i,j,k-1} - T_{i-1,j,k-1} + T_{i,j-1,k-1} - T_{i-1,j-1,k-1}.
\end{equation} 
\noindent Aplicando a equação \ref{fsm_8p_derivative} para as outras direções e substituindo na equação \ref{eikonal_full}, obtém-se
\begin{equation}
	\left(\dfrac{T_{i,j,k} - T_i}{4\,dh_x}\right)^2 + \left(\dfrac{T_{i,j,k} - T_j}{4\,dh_y}\right)^2 + \left(\dfrac{T_{i,j,k} - T_k}{4\,dh_z}\right)^2 = S^2_{i,j,k}
	\label{quadratic}
\end{equation}
\noindent onde $dh_x$, $dh_y$ e $dh_z$ são os parâmetros de discretização espaciais para as direções cartesianas. Embora a formulação de \citeonline{noble2014accurate} disponibilize a opção de heterogeneizar os espaçamentos da malha, o espaçamento fixo foi utilizado neste trabalho. A partir da equação de segundo grau \ref{quadratic}, onde $T_{i,j,k}$ é a incógnita, duas soluções são possíveis, entretanto, somente a solução de maior magnitude é considerada. \citeonline{noble2014accurate} mostram os coeficientes que resolvem o problema \ref{quadratic}, apresenta os operadores em sua forma cartesiana e esférica. Os autores da formulação hospedam um repositório no GitHub com os códigos desenvolvidos para gerar os resultados publicados. Apesar da utilização de operadores em coordenadas esféricas próximos da fonte para melhorar a precisão do tempo de trânsito, somente os operadores cartesianos foram aplicados no desenvolvimento deste trabalho.        

A primeira forma de paralelização do FSM foi desenvolvida por \citeonline{zhao2007parallel}, porém limitações para grande quantidade de processos simultâneos foram encontradas, fazendo com que o tempo de execução se estabelecesse constante com o aumento do poder computacional. \citeonline{detrixhe2013parallel} desenvolvem uma técnica que supera o problema encontrado na formulação de \citeonline{zhao2007parallel}, onde a performance é proporcional ao aumento do poder computacional. Basicamente, a direção de percorrimento no modelo de tempo de trânsito acontece em planos diagonais e os pontos desses planos podem ser atualizados simultaneamente. O modelo de propriedades de formato cúbico ou paralelepipédico possui oito quinas, então, a partir de cada quina, a direção de percorrimento segue de uma quina origem até a quina espelhada oposta, percorrendo cada plano diagonal e aplicando os operadores de diferenças finitas. Por consequência da implementação dos operadores 3D de precisão, somente três formas de resolução são aplicadas no núcleo do FSM. O primeiro segue o formado dos operadores 1D de \citeonline{vidale1988finite} e \citeonline{podvin1991finite}, baseados na cinemática clássica (equação \ref{1d_head_wave}), o segundo segue os operadores 2D de quatro pontos apresentados por \citeonline{vidale1988finite} e o terceiro é a expansão do operador 3D de \citeonline{noble2014accurate}. Com a diminuição dos operadores no núcleo da modelagem, o caso sequencial é viável, porém, neste trabalho, a forma paralelizada de \citeonline{detrixhe2013parallel} foi aplicada.  

\subsection{Modelagem do tempo de trânsito em volumes esparsos}

Ao empregar soluções numéricas da equação eikonal em modelos de malha esparsa, o cálculo do tempo analítico na fonte desempenha um papel essencial na determinação precisa dos tempos de chegada das ondas sísmicas em pontos específicos. Sabendo a posição da fonte, o pré condicionamento realizado seria a inicialização dos pontos da malha em torno da fonte com tempos analíticos considerando uma velocidade constante seguindo a equação
\begin{equation}
	T_a = S_f \sqrt{(x_g - x_f)^2 + (y_g - y_f)^2 + (z_g - z_f)^2}, 
	\label{analyticalT}
\end{equation} 
\noindent onde $T_a$ é o tempo analítico, $S_f$ é a vagarosidade en torno da fonte, $x_g,y_g$ e $z_g$ são as coordenadas dos pontos da malha em metros e $x_f,y_f$ e $z_f$ são as coordenadas da fonte. Assim no início das operações do calculo dos tempos, assumimos que os pontos vizinhos da fonte estão com os tempos corretos pronto para serem propagados numericamente.    

A aplicação da interpolação trilinear nos receptores é uma estratégia fundamental para estimar os tempos de trânsito em pontos de observação distantes, nos quais a resolução espacial dos dados é limitada devido à natureza de modelos esparsos. Apesar da característica esférica, a interpolação trilinear consegue recuperar as estruturas dos tempos de trânsito em pontos fora da malha. Essa estratégia se baseia na função a seguir
\begin{equation}
	f(x,y,z) \approx a_{0} + a_{1}x + a_{2}y + a_{3}z + a_{4}xy + a_{5}xz + a_{6}yz + a_{7}xyz},
	\label{trilinear}
\end{equation}  
\noindent sendo $(x,y,z)$ a posição desejada e $a_i$ os coeficientes que governam as propriedades naquela região. Então, de acordo com o sistema linear abaixo 

\begin{equation}
	\begin{bmatrix}
		1 & x_0 & y_0 & z_0 & x_0y_0 & x_0z_0 & x_0y_0 & x_0y_0z_0 \\
		1 & x_1 & y_0 & z_0 & x_1y_0 & x_1z_0 & x_0y_0 & x_1y_0z_0 \\
		1 & x_0 & y_1 & z_0 & x_0y_1 & x_0z_0 & x_1y_0 & x_0y_1z_0 \\
		1 & x_1 & y_1 & z_0 & x_1_y_1 & x_1z_0 & x_1y_0 & x_1y_1z_0 \\
		1 & x_0 & y_0 & z_1 & x_0y_0 & x_0z_1 & x_0y_1 & x_0y_0z_1 \\
		1 & x_1 & y_0 & z_1 & x_1y_0 & x_1z_1 & x_0y_1 & x_1y_0z_1 \\
		1 & x_0 & y_1 & z_1 & x_0y_1 & x_0z_1 & x_1y_1 & x_0y_1z_1 \\
		1 & x_1 & y_1 & z_1 & x_1y_1 & x_1z_1 & x_1y_1 & x_1y_1z_1 \\
	\end{bmatrix}
	\begin{bmatrix}
		a_0 \\
		a_1 \\
		a_2 \\
		a_3 \\
		a_4 \\
		a_5 \\
		a_6 \\
		a_7 \\
	\end{bmatrix}
	= \begin{bmatrix}
		T_{000} \\
		T_{100} \\
		T_{010} \\
		T_{110} \\
		T_{001} \\
		T_{101} \\
		T_{011} \\
		T_{111} \\
	\end{bmatrix},
\end{equation}

\noindent onde $T_{ijk}$ são os tempos de trânsito e $(x_i,y_i,z_i)$ as respectivas posições dos tempos conhecidos, os coeficientes para a equação \ref{trilinear} podem ser encontrados.  
